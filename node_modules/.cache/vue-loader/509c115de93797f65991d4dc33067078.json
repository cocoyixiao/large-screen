{"remainingRequest":"/Users/edy/work/large-screen/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/edy/work/large-screen/src/App.vue?vue&type=style&index=0&id=89345c3e&prod&lang=css&","dependencies":[{"path":"/Users/edy/work/large-screen/src/App.vue","mtime":1679552358196},{"path":"/Users/edy/work/large-screen/node_modules/css-loader/dist/cjs.js","mtime":1679560602025},{"path":"/Users/edy/work/large-screen/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1679560602514},{"path":"/Users/edy/work/large-screen/node_modules/postcss-loader/src/index.js","mtime":1679560602178},{"path":"/Users/edy/work/large-screen/node_modules/cache-loader/dist/cjs.js","mtime":1679560601711},{"path":"/Users/edy/work/large-screen/node_modules/vue-loader/lib/index.js","mtime":1679560602306}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIi4vYXNzZXRzL2Nzcy9wYWdlLmNzcyIK"},{"version":3,"sources":["App.vue"],"names":[],"mappings":";AAuPA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n<div id=\"app\">\n  <ScaleBox\n    :width=\"1920\"\n    :height=\"1080\"\n    bgc=\"transparent\"\n    :delay=\"100\"\n  >\n    <template>\n      <div class=\"login-area\" v-if=\"!hanLogin\">\n        <div class=\"login area\">\n          <h2>登录</h2>\n          <div class=\"login-content\">\n            <div class=\"pwd-line\">\n              <span>密码：</span>\n              <input v-model=\"password\" type=\"text\" @keyup.enter=\"submit\"/>\n            </div>\n            <p class=\"error-msg\" v-if=\"errorMsg\">{{ errorMsg }}</p>\n            <button class=\"login-btn\" @click=\"submit\">登录</button>\n          </div>\n        </div>\n      </div>\n      <div class=\"page\" v-else>\n        <div class=\"header\">\n          <h1>名医在线数据大屏</h1>\n          <p class=\"time\">{{ time }}</p>\n          <p class=\"header-bg\"></p>\n        </div>\n        <div class=\"wrapper\">\n          <LeftSider ref=\"leftSiderRef\"/>\n          <div class=\"content\">\n            <div class=\"total-content\">\n              <div class=\"patient total-area\">\n                <RollNumber ref=\"rollPatientRef\"/>\n                <p class=\"total-title\">今日服务患者</p>\n              </div>\n              <div class=\"doctor total-area\">\n                <RollNumber ref=\"rollDoctorRef\" />\n                <p class=\"total-title\">今日接诊医生</p>\n              </div>\n            </div>\n            <MonthData ref=\"monthRef\"/>\n            <div class=\"map-waper\">\n              <MapChina ref=\"mapRef\"/>\n            </div>\n          </div>\n          <RightSider ref=\"rightSiderRef\"/>\n        </div>\n      </div>\n    </template>\n  </ScaleBox>\n</div>\n</template>\n\n<script>\nimport ScaleBox from 'vue2-scale-box'\nimport MapChina from './components/MapChina.vue'\nimport MonthData from './components/MonthData.vue'\nimport LeftSider from './components/LeftSider.vue'\nimport RightSider from './components/RightSider.vue'\nimport RollNumber from './components/RollNumber.vue'\nimport { login, indexData, getDoctorDatas } from './api/coin'\nimport { setToken, getToken } from './utils/auth'\nimport { getAppToken } from './utils/get-token'\nimport { queryParams } from './utils/_util'\nexport default {\n  name: 'App',\n  components: {\n    ScaleBox,\n    MonthData,\n    MapChina,\n    LeftSider,\n    RightSider,\n    RollNumber\n  },\n  data () {\n    return {\n      hanLogin: false,\n      todayPatient: 0,\n      todayDoctor: 0,\n      todayPatientOld: 0,\n      todayDoctorOld: 0,\n      time: '',\n      token: '',\n      doctorList: [],\n      indexData: null,\n      wenzhenNumber: 0,\n      updateTime: 5 * 60 * 1000,\n      password: '',\n      errorMsg: '',\n      timer: null\n    }\n  },\n  mounted() {\n    const source = queryParams('from')\n    if (source === 'app') {\n      getAppToken().then(res => {\n        setToken(res)\n        this.initDatas()\n      }).catch(e => {\n        console.log(e)\n      })\n    } else {\n      const hasToken = getToken()\n      if (hasToken) {\n        this.initDatas()\n      }\n    }\n    this.initBodySize()\n  },\n  watch: {\n    password(val) {\n      if(!val) {\n        this.errorMsg = ''\n      }\n    }\n  },\n  methods: {\n    submit() {\n      login({\n        pwd: this.password\n      }).then(res => {\n        if (res.message) {\n          this.errorMsg = res.message\n          return\n        }\n        if (res.token) {\n          const token = res.token\n          setToken(token)\n          this.initDatas()\n        }\n      })\n    },\n    initDatas() {\n      this.hanLogin = true\n      this.getIndexDatas()\n      this.initTime()\n    },\n    initTime() {\n      this.creatTime()\n      setInterval(()=> {\n        this.creatTime()\n      }, 1000)\n    },\n    getIndexDatas() {\n      indexData({}).then(res=> {\n        this.indexData = res\n        this.$refs.rightSiderRef.initTarget(res.target_per)\n        this.updateDatas()\n      })\n    },\n    updateDatas() {\n      if (this.timer) {\n        clearTimeout(this.timer)\n      }\n      getDoctorDatas({}).then(res=> {\n        const result = res.wenzhenNum\n        // 中间大数字\n        this.todayPatientOld = this.todayPatient || result.today.pat_num\n        this.todayPatient = result.today.pat_num\n        const disPat = this.todayPatient - this.todayPatientOld\n        this.$refs.rollPatientRef.initRoll(this.todayPatientOld, disPat)\n\n        this.todayDoctorOld = this.todayDoctor || result.today.doc_num\n        this.todayDoctor = result.today.doc_num\n        const disDoc = this.todayDoctor - this.todayDoctorOld\n        this.$refs.rollDoctorRef.initRoll(this.todayDoctorOld, disDoc)\n\n        this.wenzhenNumber = result.today.wenzhen_num\n\n        // 左侧数据计算\n        this.resetLeftData()\n        if (!this.isUpdate) {\n          // 右侧医生列表\n          this.$refs.rightSiderRef.initList(result.doctorList)\n          // 初始化中间数据\n          this.$refs.monthRef.init(this.indexData.history_num)\n          this.$refs.mapRef.init(this.indexData.pharmacyorder30)\n        }\n        // 开启数据刷新\n        this.timer = setTimeout(()=> {\n          this.updateDatas()\n          this.isUpdate = true\n        }, this.updateTime)\n      })\n    },\n    resetLeftData() {\n      const leftRef = this.$refs.leftSiderRef\n      const wzNum = this.indexData.wenzhenNum\n      const yearData = wzNum.year.wenzhen_num + this.wenzhenNumber\n      const monthData = wzNum.month.wenzhen_num + this.wenzhenNumber\n      const weekData = wzNum.week.wenzhen_num + this.wenzhenNumber\n      leftRef.initWenZhen(yearData, monthData, weekData)\n\n      leftRef.initManWoman(wzNum.year.man_per/100, wzNum.year.woman_per/100)\n\n      leftRef.initSuggest(this.indexData.complain)\n    },\n    creatTime() {\n      const date = new Date();\n      const year = date.getFullYear();\n      const month = date.getMonth() + 1;\n      const dates = date.getDate();\n      const day = new Array(\"星期日\", \"星期一\", \"星期二\", \"星期三\", \"星期四\", \"星期五\", \"星期六\")[date.getDay()];\n      const hour = date.getHours() < 10 ? \"0\" + date.getHours() : date.getHours();\n      const minute = date.getMinutes() < 10 ? \"0\" + date.getMinutes() : date.getMinutes()\n      const seconds = date.getSeconds() < 10 ? \"0\" + date.getSeconds() : date.getSeconds()\n      this.time = year + \"年\" + month + \"月\" + dates + \"日 \" + hour + \":\" + minute + \":\" + seconds + \" \" + day;\n    },\n    initBodySize() {\n      var bodyStyle = document.createElement('style')\n      bodyStyle.innerHTML=`body{width:1920px; height:1080px!important;}`\n      document.documentElement.firstElementChild.appendChild(bodyStyle)\n\n      function refreshScale(){\n        let docWidth = document.documentElement.clientWidth;\n        let docHeight = document.documentElement.clientHeight;\n        var designWidth = 1920\n        var designHeight = 1080\n        var widthRatio = docWidth / designWidth\n        var heightRatio = docHeight / designHeight; // 缩放比例\n        document.body.style = `transform:scale(\" + widthRatio + \",\" + heightRatio + \");transform-origin:left top;`;\n      // 应对浏览器 全屏切换前后 窗口因短暂滚动条问题出现未占满情况\n        setTimeout(function(){\n          var lateWidth= document.documentElement.clientWidth,\n            lateHeight = document.documentElement.clientHeight;\n          if(lateWidth===docWidth) return;\n\n          widthRatio = lateWidth/ designWidth\n          heightRatio = lateHeight/ designHeight\n          document.body.style = \"transform:scale(\" + widthRatio + \",\" + heightRatio + \");transform-origin:left top;\"\n        },0)\n      }\n      refreshScale()\n\n      window.addEventListener(\"pageshow\", function (e) {\n        if (e.persisted) { // 浏览器后退的时候重新计算\n          refreshScale()\n        }\n      }, false);\n      window.addEventListener(\"resize\", refreshScale, false);\n    }\n  }\n}\n</script>\n\n<style>\n@import \"./assets/css/page.css\"\n</style>\n"]}]}